<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Proton Drive WebDAV Bridge</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body class="light-theme">
    <header class="box bg-1">
      <h1 class="header-xl">Proton Drive WebDAV Bridge</h1>
      <div id="permissions" title="Background Activity permission"></div>
    </header>

    <main class="box bg-2">
      <div class="frame rounded" style="padding: 1rem">
        <!-- outer frame to match reference -->

        <div class="app-layout">
          <!-- LEFT SIDEBAR: ADWave-style navigation -->
          <aside class="sidebar card adw-sidebar" aria-label="Primary">
            <div
              class="sidebar-header"
              style="display: flex; align-items: center; gap: 12px; margin-bottom: 10px"
            >
              <div class="app-icon" aria-hidden="true">üìÅ</div>
              <div>
                <div class="header-sm">Proton Drive</div>
                <div class="subtitle">WebDAV Bridge</div>
              </div>
            </div>

            <div class="nav-sidebar" role="navigation" aria-label="Accounts sidebar">
              <div id="account-list" class="nav-sidebar-list" role="listbox" aria-label="Accounts">
                <!-- account buttons injected here -->
              </div>

              <span class="separator" aria-hidden="true"></span>

              <div class="nav-sidebar-controls">
                <button id="add-account" class="nav-sidebar-btn">Add account</button>

                <div style="display: flex; align-items: center; gap: 8px">
                  <div style="display: flex; flex-direction: column">
                    <div class="label">Autostart</div>
                    <div class="subtitle">Start at login</div>
                  </div>
                  <div>
                    <adw-switch id="autostart-switch-side" active="false"></adw-switch>
                    <input id="autostart-toggle-side" type="checkbox" hidden aria-hidden="true" />
                  </div>
                </div>
              </div>
            </div>
          </aside>

          <!-- MAIN CONTENT: per-account / global status -->
          <section class="content-area">
            <!-- Per-account details -->
            <section id="account-details" class="card">
              <div
                class="account-header"
                style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  gap: 12px;
                "
              >
                <div>
                  <div id="account-email" class="header-sm">No account selected</div>
                  <div id="account-status-text" class="subtitle">‚Äî</div>
                </div>
                <div class="account-actions" style="display: flex; gap: 8px">
                  <button id="configure-account" class="btn">Configure</button>
                  <button id="signout-account" class="btn danger">Sign out</button>
                </div>
              </div>

              <div class="list settings-list" style="margin-top: 12px">
                <div class="list-element settings-row">
                  <div class="settings-desc">
                    <div class="label">Mount</div>
                    <div class="subtitle">Mount the WebDAV share for this account</div>
                  </div>
                  <div class="settings-control">
                    <adw-switch id="account-mount-switch" active="false"></adw-switch>
                    <input id="account-mount-toggle" type="checkbox" hidden aria-hidden="true" />
                  </div>
                </div>

                <div class="list-element settings-row">
                  <div class="settings-desc">
                    <div class="label">Address</div>
                    <div class="subtitle">Local WebDAV address for account</div>
                  </div>
                  <div
                    class="settings-control"
                    style="display: flex; align-items: center; gap: 8px"
                  >
                    <adw-input id="account-dav-url" class="input" readonly></adw-input>
                    <input
                      id="account-dav-url-fallback"
                      class="input"
                      type="text"
                      readonly
                      style="display: none"
                    />
                    <button id="account-copy-url" class="btn flat">Copy</button>
                  </div>
                </div>

                <div class="list-element settings-row">
                  <div class="settings-desc">
                    <div class="label">Network Port</div>
                    <div class="subtitle">Local port used by this account</div>
                  </div>
                  <div class="settings-control">
                    <adw-input id="account-network-port" class="input" readonly></adw-input>
                    <input
                      id="account-network-port-fallback"
                      class="input"
                      type="text"
                      readonly
                      style="display: none"
                    />
                  </div>
                </div>
              </div>
            </section>

            <!-- Login / Setup -->
            <section id="login-screen" class="card hidden">
              <h2 class="header-sm">Sign in</h2>
              <p class="text">Connect your Proton Drive account to the WebDAV Bridge.</p>
              <input id="email" class="input" type="email" placeholder="you@proton.me" />
              <button id="start-auth" class="btn primary">Continue</button>
              <div id="auth-error" class="error"></div>
            </section>

            <!-- Dashboard -->
            <section id="dashboard" class="card">
              <div class="status-row">
                <div class="label badge" id="service-badge">Unknown</div>
                <div class="subtitle" id="live-status">Live status: N/A</div>
              </div>

              <div class="quota">
                <label class="label">Storage Quota</label>
                <progress id="quota-bar" value="0" max="100"></progress>
                <div id="quota-text" class="text">‚Äî</div>
              </div>

              <div class="list settings-list">
                <div class="list-element settings-row">
                  <div class="settings-desc">
                    <div class="label">Files</div>
                    <div class="subtitle">
                      Open your Proton Drive folder in the system file manager
                    </div>
                  </div>
                  <div class="settings-control">
                    <button id="open-files" class="btn primary">Open in File Manager</button>
                  </div>
                </div>

                <div class="list-element settings-row">
                  <div class="settings-desc">
                    <div class="label">Mount</div>
                    <div class="subtitle">Mount the WebDAV share to your file manager</div>
                  </div>
                  <div
                    class="settings-control"
                    style="display: flex; align-items: center; gap: 12px"
                  >
                    <label class="switch" title="Mount">
                      <adw-switch id="mount-switch" active="false"></adw-switch>
                      <input id="mount-toggle" type="checkbox" hidden aria-hidden="true" />
                    </label>
                    <div id="mount-status" class="mount-status">Checking mount status...</div>
                  </div>
                </div>

                <div class="list-element settings-row">
                  <div class="settings-desc">
                    <div class="label">Address</div>
                    <div class="subtitle">Local WebDAV address</div>
                  </div>
                  <div
                    class="settings-control"
                    style="display: flex; align-items: center; gap: 8px"
                  >
                    <adw-input id="dav-url" class="input" readonly></adw-input>
                    <!-- fallback plain input for legacy/tests -->
                    <input
                      id="dav-url-fallback"
                      class="input"
                      type="text"
                      readonly
                      style="display: none"
                    />
                    <button id="copy-url" class="btn flat">Copy</button>
                  </div>
                </div>

                <div class="list-element settings-row">
                  <div class="settings-desc">
                    <div class="label">Startup</div>
                    <div class="subtitle">Autostart and persistence preferences</div>
                  </div>
                  <div
                    class="settings-control"
                    style="display: flex; gap: 12px; align-items: center"
                  >
                    <div
                      style="display: flex; flex-direction: column; gap: 6px; align-items: flex-end"
                    >
                      <div style="display: flex; gap: 8px; align-items: center">
                        <label class="label">Autostart</label>
                        <label class="switch">
                          <adw-switch id="autostart-switch" active="false"></adw-switch>
                          <input id="autostart-toggle" type="checkbox" hidden aria-hidden="true" />
                        </label>
                      </div>
                      <div style="display: flex; gap: 8px; align-items: center">
                        <label class="label">Persistence</label>
                        <label class="switch">
                          <adw-switch id="persistence-switch" active="false"></adw-switch>
                          <input
                            id="persistence-toggle"
                            type="checkbox"
                            hidden
                            aria-hidden="true"
                          />
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <details id="advanced">
                <summary>Advanced / Troubleshoot</summary>
                <div class="advanced-grid">
                  <div
                    class="list-element"
                    style="
                      display: flex;
                      justify-content: space-between;
                      align-items: center;
                      gap: 12px;
                    "
                  >
                    <div>
                      <div class="label">Network Port</div>
                      <div class="subtitle">Set local WebDAV listening port</div>
                    </div>
                    <div style="display: flex; gap: 8px; align-items: center">
                      <adw-input id="network-port" class="input" readonly></adw-input>
                      <input
                        id="network-port-fallback"
                        class="input"
                        type="number"
                        min="1024"
                        max="65535"
                        value="12345"
                        style="display: none"
                      />
                      <button id="apply-port" class="btn">Apply</button>
                    </div>
                  </div>

                  <div style="display: flex; gap: 8px">
                    <button id="purge-cache" class="btn">Purge Cache</button>
                    <button id="logout" class="btn danger">Logout / Reset Auth</button>
                  </div>
                </div>
              </details>

              <div class="log-console">
                <button id="toggle-log" class="btn flat">Show Logs</button>
                <pre id="log-area" class="hidden"></pre>
              </div>
            </section>
          </section>
        </div>
      </div>
      <!-- /.frame -->
    </main>

    <script type="module" src="main.ts"></script>
  </body>
</html>
